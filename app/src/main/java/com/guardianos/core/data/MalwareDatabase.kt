package com.guardianos.core.data

import com.guardianos.core.domain.model.MalwareMatch

class MalwareDatabase {

    // üîç Lista de trackers conocidos (fuente: Exodus Privacy + MobSF)
    private val KNOWN_TRACKERS = mapOf(
        "com.facebook" to "Facebook SDK",
        "com.google.android.gms" to "Google Play Services (Analytics, Ads)",
        "com.google.firebase" to "Firebase Analytics",
        "com.crashlytics.sdk.android" to "Crashlytics (Fabric)",
        "com.flurry.android" to "Flurry Analytics",
        "com.appsflyer" to "AppsFlyer",
        "com.adjust.sdk" to "Adjust",
        "com.branch.sdk" to "Branch.io",
        "com.mixpanel.android" to "Mixpanel",
        "com.amplitude.android" to "Amplitude",
        "com.singular.sdk" to "Singular",
        "com.ironsource.mediationsdk" to "IronSource",
        "com.adobe.mobile" to "Adobe Analytics",
        "com.mparticle" to "mParticle",
        "com.segment.analytics" to "Segment",
        "com.tune" to "Tune (MobileAppTracking)",
        "com.yandex.metrica" to "Yandex Metrica",
        "com.startapp" to "StartApp",
        "com.inmobi" to "InMobi",
        "com.chartbeat" to "Chartbeat"
    )

    // üß™ Base de datos de malware conocido (por nombre de paquete)
    private val KNOWN_MALWARE_PACKAGES = mapOf(
        "com.demo.malware" to MalwareMatch("DemoMalware", "CRITICAL"),
        "org.fake.bank" to MalwareMatch("FakeBank", "CRITICAL"),
        "com.spy.sms" to MalwareMatch("SMSSpy", "CRITICAL"),
        "net.stealer.wallet" to MalwareMatch("CryptoStealer", "CRITICAL"),
        "com.wifihacker.whousemywifi.wifirouter.wifisecurity" to MalwareMatch("WiFi Thief Detector", "PAQUETE MALICIOSO CONOCIDO", 50)
    )

    // üß™ Palabras clave maliciosas en nombre de paquete
    private val MALICIOUS_KEYWORDS = listOf("hack", "crack", "mod", "free.vpn", "unlock", "cheat")

    // üß™ Firmas de certificados maliciosos (hashes SHA-256)
    private val KNOWN_MALWARE_CERTS = setOf(
        "a40da80a5d9f9d8a85d8f9e0a1b2c3d4e5f6a7b8c9d0e1f2a3b4c5d6e7f8a9b0"
    )

    // üîé Detectar por hash de certificado
    fun checkCertificateHash(certHash: String): MalwareMatch? {
        if (certHash in KNOWN_MALWARE_CERTS) {
            return MalwareMatch("DemoMalware", "Certificado asociado a malware conocido", 50)
        }
        return null
    }

    // üîé Detectar por nombre de paquete
    fun checkPackageName(packageName: String): MalwareMatch? {
        // Coincidencia exacta
        KNOWN_MALWARE_PACKAGES[packageName]?.let { return it }

        // Palabras clave maliciosas
        if (MALICIOUS_KEYWORDS.any { packageName.contains(it, ignoreCase = true) }) {
            return MalwareMatch("DemoMalware", "Nombre sugiere app maliciosa o modificada", 50)
        }

        return null
    }

    // üîé NUEVO: Detectar trackers conocidos
    fun checkTracker(packageName: String): MalwareMatch? {
        for ((prefix, name) in KNOWN_TRACKERS) {
            if (packageName.startsWith(prefix)) {
                return MalwareMatch(name, "Tracker de an√°lisis/comportamiento", 40)
            }
        }
        return null
    }
}
